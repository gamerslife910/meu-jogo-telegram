<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EURODASH ULTIMATE</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap');
        
        body { background: #050505; color: #fff; font-family: 'Rajdhani', sans-serif; margin: 0; text-align: center; overflow: hidden; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        /* --- LOADING SCREEN FUTURISTA --- */
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .scanner { width: 100%; height: 2px; background: #0f9; box-shadow: 0 0 10px #0f9; animation: scan 2s infinite; position: absolute; top:0; }
        .load-bar-box { width: 200px; height: 6px; background: #222; border-radius: 3px; margin-top: 20px; overflow: hidden; }
        .load-bar { height: 100%; background: #0f9; width: 0%; transition: width 4s linear; box-shadow: 0 0 10px #0f9; }
        @keyframes scan { 0% { top: 0%; opacity: 0; } 50% { opacity: 1; } 100% { top: 100%; opacity: 0; } }
        
        /* --- UI GERAL --- */
        .lang-bar { display: flex; justify-content: center; gap: 10px; padding: 15px; background: rgba(17,17,17,0.9); border-bottom: 1px solid #0f9; backdrop-filter: blur(5px); }
        .t-btn { background: transparent; color: #555; border: 1px solid #333; padding: 5px 15px; border-radius: 4px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .t-btn.active { background: rgba(0,255,153,0.1); color: #0f9; border-color: #0f9; box-shadow: 0 0 8px rgba(0,255,153,0.2); }
        
        #balance { font-size: 48px; margin: 15px 0; font-weight: 700; color: #fff; text-shadow: 0 0 15px rgba(0,255,153,0.6); letter-spacing: 2px; }
        .currency { color: #0f9; font-size: 24px; vertical-align: super; }
        
        /* --- MAIN BUTTON & EFFECTS --- */
        .main-img-con { position: relative; width: 180px; height: 180px; margin: 0 auto; }
        .main-img { width: 100%; height: 100%; border-radius: 50%; border: 3px solid #0f9; box-shadow: 0 0 25px rgba(0,255,153,0.4); cursor: pointer; transition: transform 0.05s; z-index: 10; position: relative; }
        .main-img:active { transform: scale(0.94); }
        
        /* Part√≠culas de dinheiro */
        .float-text { position: absolute; color: #0f9; font-weight: bold; font-size: 20px; pointer-events: none; animation: floatUp 1s ease-out forwards; text-shadow: 0 0 5px #000; z-index: 20; }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-80px) scale(1.2); opacity: 0; } }

        /* --- TABS --- */
        .tab { display: none; padding: 20px; padding-bottom: 120px; height: 75vh; overflow-y: auto; scrollbar-width: none; }
        .tab::-webkit-scrollbar { display: none; }
        
        /* --- MERCADO --- */
        .item { background: rgba(20,20,20,0.8); border: 1px solid #333; padding: 12px; border-radius: 12px; display: flex; align-items: center; margin-bottom: 12px; gap: 12px; transition: 0.2s; position: relative; overflow: hidden; }
        .item::before { content: ''; position: absolute; top:0; left:0; width: 2px; height: 100%; background: #0f9; }
        .m-img { width: 60px; height: 60px; border-radius: 8px; background: #000; border: 1px solid #444; object-fit: cover; }
        .m-info { flex-grow: 1; text-align: left; }
        .buy-btn { background: #0f9; color: #000; border: none; padding: 8px 15px; border-radius: 6px; font-weight: bold; font-family: 'Rajdhani'; font-size: 16px; cursor: pointer; box-shadow: 0 0 10px rgba(0,255,153,0.3); }
        .buy-btn:active { transform: scale(0.95); }

        /* --- AMIGOS & TASKS --- */
        .panel { background: #111; border: 1px solid #333; border-radius: 15px; padding: 20px; margin-bottom: 15px; text-align: left; }
        .invite-box { background: #000; border: 1px dashed #555; padding: 10px; margin: 10px 0; font-family: monospace; color: #888; word-break: break-all; font-size: 12px; }
        .action-btn { width: 100%; background: #222; color: #fff; border: 1px solid #0f9; padding: 12px; border-radius: 8px; font-weight: bold; margin-top: 5px; font-size: 16px; display: flex; justify-content: space-between; align-items: center; }
        .task-done { opacity: 0.5; border-color: #555; color: #888; pointer-events: none; }

        /* --- NAV --- */
        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: rgba(10,10,10,0.95); border-top: 1px solid #222; padding-bottom: 20px; z-index: 100; backdrop-filter: blur(10px); }
        .n-btn { flex: 1; padding: 15px 0; color: #666; font-size: 14px; font-weight: bold; transition: 0.3s; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .n-btn.active { color: #0f9; text-shadow: 0 0 8px rgba(0,255,153,0.4); }
        .n-icon { font-size: 20px; }

        h2 { color: #0f9; margin-top: 0; text-transform: uppercase; letter-spacing: 1px; }
        small { color: #888; font-size: 11px; }
    </style>
</head>
<body>

    <div id="loader">
        <div class="scanner"></div>
        <h1 style="font-size: 40px; margin:0; letter-spacing: 5px; color:#fff;">EURO<span style="color:#0f9">DASH</span></h1>
        <div class="load-bar-box"><div class="load-bar" id="p-bar"></div></div>
        <p style="color:#666; font-size: 12px; margin-top: 10px;" id="load-txt">INITIALIZING SYSTEM...</p>
    </div>

    <div class="lang-bar">
        <button class="t-btn active" id="btn-pt" onclick="setL('pt')">PT</button>
        <button class="t-btn" id="btn-en" onclick="setL('en')">EN</button>
        <button class="t-btn" id="btn-ru" onclick="setL('ru')">RU</button>
    </div>

    <div id="tab-core" class="tab" style="display:block;">
        <div id="balance"><span class="currency">‚Ç¨</span><span id="bal-val">0.00000</span></div>
        <div class="main-img-con">
            <img src="image_3.jpg" class="main-img" id="click-btn" onerror="this.src='https://via.placeholder.com/180/000/0f9?text=TAP'">
        </div>
        <div style="margin-top: 30px; background: #111; padding: 10px; border-radius: 50px; border: 1px solid #333; display: inline-block; padding-left: 20px; padding-right: 20px;">
             ‚ö° <span id="eg" style="color:#fff; font-weight:bold">500</span> <span style="color:#444">/ 500</span>
        </div>
    </div>

    <div id="tab-shop" class="tab">
        <h2 id="txt-m">MERCADO</h2>
        <div id="shop-list"></div>
    </div>

    <div id="tab-friends" class="tab">
        <h2 id="txt-f">AMIGOS</h2>
        <div class="panel">
            <h3 style="margin:0; color:#fff" id="txt-inv">Convida e Ganha</h3>
            <p style="color:#888; font-size:13px;" id="txt-inv-desc">Convida amigos para ganhar b√≥nus de energia e dinheiro no futuro.</p>
            <div class="invite-box" id="my-link">Generating link...</div>
            <button class="action-btn" onclick="copyLink()" style="justify-content:center; color:#000; background:#0f9;">
                <span id="txt-copy">COPIAR LINK</span>
            </button>
        </div>
        <div class="panel">
            <div style="display:flex; justify-content:space-between;">
                <span>Total Invited:</span>
                <b style="color:#0f9">0</b>
            </div>
        </div>
    </div>

    <div id="tab-earn" class="tab">
        <h2 id="txt-e">GANHAR</h2>
        <div class="panel" style="border-color: #0f9;">
            <div style="font-size:14px; margin-bottom:10px;" id="txt-join">Entra no Grupo Oficial</div>
            <button id="task-group" class="action-btn" onclick="doTask('group', 0.10, 'https://t.me/eurodash_official')">
                <span>JOIN</span>
                <span style="color:#0f9">+‚Ç¨0.10</span>
            </button>
        </div>
        <div class="panel">
            <div style="font-size:14px; margin-bottom:10px;" id="txt-like">Segue no X (Twitter)</div>
            <button id="task-x" class="action-btn" onclick="doTask('x', 0.05, 'https://twitter.com')">
                <span>FOLLOW</span>
                <span style="color:#0f9">+‚Ç¨0.05</span>
            </button>
        </div>
    </div>

    <div class="nav">
        <div class="n-btn active" id="nb-core" onclick="sw('core')">
            <span class="n-icon">üè†</span> <span id="n-home">IN√çCIO</span>
        </div>
        <div class="n-btn" id="nb-shop" onclick="sw('shop')">
            <span class="n-icon">üõí</span> <span id="n-shop">MERCADO</span>
        </div>
        <div class="n-btn" id="nb-friends" onclick="sw('friends')">
            <span class="n-icon">üë•</span> <span id="n-friends">AMIGOS</span>
        </div>
        <div class="n-btn" id="nb-earn" onclick="sw('earn')">
            <span class="n-icon">üí∏</span> <span id="n-earn">TASKS</span>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // --- DATA & CONFIG ---
        let L = 'pt';
        const txt = {
            pt: { 
                m: "MERCADO", f: "AMIGOS", e: "TAREFAS", inv: "Convida Amigos", desc: "Ganha b√≥nus por cada amigo.", cp: "COPIAR", 
                n: ["IN√çCIO","MERCADO","AMIGOS","TASKS"], names: ["N√≥ Micro","Rack Blade","Turbo Server","Cyber Station","Quantum Rig","Hub Neural","N√∫cleo Titan"]
            },
            en: { 
                m: "MARKET", f: "FRIENDS", e: "TASKS", inv: "Invite Friends", desc: "Earn bonuses for each invite.", cp: "COPY LINK", 
                n: ["HOME","MARKET","FRIENDS","TASKS"], names: ["Micro Node","Blade Rack","Turbo Server","Cyber Station","Quantum Rig","Neural Hub","Titan Core"]
            },
            ru: { 
                m: "–†–´–ù–û–ö", f: "–î–†–£–ó–¨–Ø", e: "–ó–ê–î–ê–ù–ò–Ø", inv: "–ü—Ä–∏–≥–ª–∞—Å–∏ –î—Ä—É–∑–µ–π", desc: "–ü–æ–ª—É—á–∞–π –±–æ–Ω—É—Å—ã –∑–∞ –¥—Ä—É–∑–µ–π.", cp: "–ö–û–ü–ò–†–û–í–ê–¢–¨", 
                n: ["–ì–õ–ê–í–ù–ê–Ø","–†–´–ù–û–ö","–î–†–£–ó–¨–Ø","–ó–ê–î–ê–ù–ò–Ø"], names: ["–ú–∏–∫—Ä–æ –£–∑–µ–ª","Blade –°—Ç–æ–π–∫–∞","–¢—É—Ä–±–æ –°–µ—Ä–≤–µ—Ä","–ö–∏–±–µ—Ä –°—Ç–∞–Ω—Ü–∏—è","–ö–≤–∞–Ω—Ç–æ–≤—ã–π –†–∏–≥","–ù–µ–π—Ä–æ –•–∞–±","–Ø–¥—Ä–æ –¢–∏—Ç–∞–Ω–∞"]
            }
        };

        const miners = [
            {p:0.05, g:0.0000001, img: "miner1.jpg"}, {p:1, g:0.0000006, img: "miner2.jpg"}, 
            {p:10, g:0.0000075, img: "miner3.jpg"}, {p:50, g:0.000045, img: "miner4.jpg"}, 
            {p:200, g:0.00021, img: "miner5.jpg"}, {p:800, g:0.00095, img: "miner6.jpg"}, 
            {p:3000, g:0.0045, img: "miner7.jpg"}
        ];

        let u = { bal: 0, pps: 0, eng: 500, inv: [0,0,0,0,0,0,0], tasks: {} };
        let loaded = false; // PROTE√á√ÉO DE DADOS

        // --- FIREBASE SETUP ---
        firebase.initializeApp({
            apiKey: "AIzaSyDFpFu8sba50rqnJSstg--cLrNDG4ybmu8",
            authDomain: "eurodash-e466c.firebaseapp.com",
            databaseURL: "https://eurodash-e466c-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "eurodash-e466c",
            appId: "1:99813963051:web:fe96761e990aee01ec016e"
        });
        const db = firebase.database();
        const uid = tg.initDataUnsafe.user?.id || 22250; 
        const botName = "EuroDash_Bot"; // Substituir pelo username real do bot se souberes

        // --- LOADING SYSTEM ---
        window.onload = function() {
            // Anima√ß√£o da barra
            setTimeout(() => { document.getElementById('p-bar').style.width = "100%"; }, 100);
            
            // Carregar Dados da BD
            db.ref('users/' + uid).once('value').then(s => {
                if(s.exists()) {
                    let d = s.val();
                    u.bal = Number(d.bal) || 0;
                    u.pps = Number(d.pps) || 0;
                    u.eng = Number(d.eng) || 500;
                    u.inv = Array.isArray(d.inv) ? d.inv : [0,0,0,0,0,0,0];
                    u.tasks = d.tasks || {};
                }
                loaded = true; // S√ì AGORA √â SEGURO SALVAR
                up();
                renderShop();
                checkTasks();
                
                // Remover Loader ap√≥s 4s
                setTimeout(() => {
                    document.getElementById('loader').style.opacity = 0;
                    setTimeout(() => { document.getElementById('loader').style.display = 'none'; }, 500);
                }, 4000);
            });
            
            // Gerar Link de Convite
            document.getElementById('my-link').innerText = `https://t.me/${botName}?start=${uid}`;
        };

        // --- CORE LOGIC ---
        // Click com Efeitos Visuais
        document.getElementById('click-btn').addEventListener('click', (e) => {
            if(u.eng < 1) { tg.HapticFeedback.notificationOccurred('warning'); return; }
            
            u.bal += 0.00005;
            u.eng -= 1;
            up();
            tg.HapticFeedback.impactOccurred('medium');

            // Criar part√≠cula de dinheiro
            const el = document.createElement('div');
            el.innerText = '+‚Ç¨0.00005';
            el.className = 'float-text';
            el.style.left = e.clientX + 'px';
            el.style.top = e.clientY + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        });

        function up() {
            document.getElementById('bal-val').innerText = u.bal.toFixed(5);
            document.getElementById('eg').innerText = Math.floor(u.eng);
        }

        // --- SHOP SYSTEM ---
        function renderShop() {
            document.getElementById('shop-list').innerHTML = miners.map((m,i) => `
                <div class="item">
                    <img src="${m.img}" class="m-img" onerror="this.src='https://via.placeholder.com/60/111/0f9?text=${i+1}'">
                    <div class="m-info">
                        <b style="color:#0f9; font-size:17px">${txt[L].names[i]}</b><br>
                        <small style="color:#aaa">Lvl: <span style="color:#fff">${u.inv[i]||0}</span> | +‚Ç¨${(m.g*3600).toFixed(5)}/h</small>
                    </div>
                    <button class="buy-btn" onclick="buy(${i})">‚Ç¨${m.p}</button>
                </div>
            `).join('');
        }

        function buy(i) {
            if(!loaded) return;
            if(u.bal >= miners[i].p) {
                u.bal -= miners[i].p;
                u.pps += miners[i].g;
                u.inv[i] = (u.inv[i]||0) + 1;
                renderShop(); up();
                tg.HapticFeedback.notificationOccurred('success');
            } else {
                tg.HapticFeedback.notificationOccurred('error');
            }
        }

        // --- TASK SYSTEM (EARN) ---
        function doTask(taskId, reward, url) {
            if(u.tasks[taskId]) return; // J√° fez
            
            // Abre o link
            tg.openLink(url);
            
            // Simula verifica√ß√£o (num sistema real seria via backend)
            setTimeout(() => {
                if(!u.tasks[taskId]) {
                    u.tasks[taskId] = true;
                    u.bal += reward;
                    up();
                    checkTasks();
                    tg.HapticFeedback.notificationOccurred('success');
                    tg.showAlert(`Task Complete! +‚Ç¨${reward}`);
                }
            }, 5000); // 5 segundos para fingir que verificou
        }

        function checkTasks() {
            if(u.tasks['group']) document.getElementById('task-group').classList.add('task-done');
            if(u.tasks['x']) document.getElementById('task-x').classList.add('task-done');
        }

        // --- UI & TRANSLATION ---
        function setL(lang) {
            L = lang;
            document.querySelectorAll('.t-btn').forEach(b => b.classList.toggle('active', b.id === 'btn-' + lang));
            
            // Atualizar Textos
            document.getElementById('txt-m').innerText = txt[L].m;
            document.getElementById('txt-f').innerText = txt[L].f;
            document.getElementById('txt-e').innerText = txt[L].e;
            document.getElementById('txt-inv').innerText = txt[L].inv;
            document.getElementById('txt-inv-desc').innerText = txt[L].desc;
            document.getElementById('txt-copy').innerText = txt[L].cp;
            
            // Nav
            document.getElementById('n-home').innerText = txt[L].n[0];
            document.getElementById('n-shop').innerText = txt[L].n[1];
            document.getElementById('n-friends').innerText = txt[L].n[2];
            document.getElementById('n-earn').innerText = txt[L].n[3];

            renderShop();
        }

        function sw(tab) {
            document.querySelectorAll('.tab').forEach(t => t.style.display = 'none');
            document.getElementById('tab-' + tab).style.display = 'block';
            
            document.querySelectorAll('.n-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('nb-' + tab).classList.add('active');
            
            tg.HapticFeedback.selectionChanged();
        }

        function copyLink() {
            const link = document.getElementById('my-link').innerText;
            navigator.clipboard.writeText(link);
            tg.HapticFeedback.notificationOccurred('success');
            const btn = document.getElementById('txt-copy');
            const old = btn.innerText;
            btn.innerText = "COPIED!";
            setTimeout(() => btn.innerText = old, 2000);
        }

        // --- LOOPS ---
        // Passive Income & Energy
        setInterval(() => {
            if(loaded) {
                u.bal += u.pps;
                if(u.eng < 500) u.eng += 0.5;
                up();
            }
        }, 1000);

        // AUTO-SAVE (S√≥ salva se loaded = true)
        setInterval(() => {
            if(loaded && uid) {
                db.ref('users/' + uid).update(u);
            }
        }, 5000);

    </script>
</body>
</html>
